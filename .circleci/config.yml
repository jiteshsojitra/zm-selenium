version: 2

############################################################################

jobs:
   build:
      docker:
         - image: jiteshsojitra/docker-headless-vnc-container
      environment:
         - CIRCLE_WORKING_DIRECTORY: /headless
      steps:
         - checkout:
              CIRCLE_WORKING_DIRECTORY: /headless
         - run:
              name: Install prerequisites
              command: bash .circleci/install-prerequisites.sh
         - run:
              name: Checkout dependent repos
              command: bash .circleci/checkout-repos.sh
         - run:
              name: Compile zm-mailbox
              working_directory: ~/zm-mailbox
              command: ant publish-local-all -Ddev.home=$CIRCLE_WORKING_DIRECTORY -Dzimbra.buildinfo.version=8.8.0_GA
         - run:
              name: Run selenium tests
              working_directory: ~/zm-selenium
              command: ant Run-ExecuteHarnessMain -Ddev.home=$CIRCLE_WORKING_DIRECTORY -Dpattern startatt.tests.competitors -Dgroups always,L0

workflows:
   version: 2
   build_selenium:
      jobs:
         - build

############################################################################